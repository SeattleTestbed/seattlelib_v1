"""
<Description>
  Same as stopcomm Repy
  
<Date>
  Sun Mar  1 10:27:35 PST 2009
"""

include sockettimeout.repy

def test_close():
  tsock = TimeoutSocket()
  tsock.sockobj = FakeSocket()
  tsock.listencommhandle = True
  tsock.commhandle = True
  tsock.callback = True
  tsock.local_address = True
  tsock.remote_address = True
  
  tsock.close()

  assert not tsock.sockobj
  assert not tsock.listencommhandle
  assert not tsock.commhandle
  assert not tsock.callback
  assert not tsock.local_address
  assert not tsock.remote_address

def test_close_twice():
  tsock = TimeoutSocket()
  tsock.sockobj = FakeSocket()
  tsock.listencommhandle = True
  tsock.commhandle = True
  tsock.callback = True
  tsock.local_address = True
  tsock.remote_address = True
  
  tsock.close()
  tsock.close()

  assert not tsock.sockobj
  assert not tsock.listencommhandle
  assert not tsock.commhandle
  assert not tsock.callback
  assert not tsock.local_address
  assert not tsock.remote_address

##############################

class FakeSocket:
  def close(self): pass

def main():
  test_close()
  test_close_twice()

if callfunc == 'initialize':
  main()
