"""
<Description>
  
<Date>
  Sun Mar  1 10:27:35 PST 2009
"""
# hello world
include sockettimeout.repy

MESSAGE = "hello world!"
HUGE = 100

def mycallback(ip, port, sockobj, commhandle, listenhandle):
  sockobj.settimeout(0)

  try:
    hw_message = sockobj.recv(HUGE)
  except SocketTimeoutError:
    pass
  else: 
    sockobj.close()
    raise Exception("should have timed out")
  
def server():
  sockobj = timeout_waitforconn(getmyip(), 12345, mycallback)

def client():
  sockobj = timeout_openconn(getmyip(), 12345)
  assert sockobj.send(MESSAGE) == len(MESSAGE)

def main():
  server()
  client()
  sleep(.1)
  exitall()

if callfunc == 'initialize':
  main()
