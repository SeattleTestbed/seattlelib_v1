"""
<Program Name>
  testurlparse.py

<Started>
  May 16, 2009

<Author>
  Michael Phan-Ba

<Purpose>
  Runs unit tests on urlparse.repy.

"""


include urlparse.repy


def testurlparse_assertEquals(expected, actual, msg):

  try:
    assert(expected == actual)
  except AssertionError, inst:
    print msg
    raise inst


def testurlparse_expectException(func, e, msg):

  try:
    func()
    print msg
    raise inst
  except e:
    pass


def testurlparse_test(test_input, expected_output, args=()):
  print "Testing input: '%s'" % test_input

  test_output = urlparse_urlsplit(test_input, *args)

  for k, v in expected_output.iteritems():
    testurlparse_assertEquals(v, test_output[k],
      "\tError: Expected '%s' for %s, got '%s'" % (v, k, test_output[k]))


if callfunc == 'initialize':

  # Test a valid absolute URL.
  testurlparse_test("scheme://user:pass@host:8888/path?query#fragment",
    {
      "scheme": "scheme",
      "netloc": "user:pass@host:8888",
      "path": "/path",
      "query": "query",
      "fragment": "fragment",
      "username": "user",
      "password": "pass",
      "hostname": "host",
      "port": 8888
    })

  # Test a valid relative URL.
  testurlparse_test("scheme:/path?query#fragment",
    {
      "scheme": "scheme",
      "netloc": "",
      "path": "/path",
      "query": "query",
      "fragment": "fragment",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    })

  # An empty URL.
  testurlparse_test("",
    {
      "scheme": "",
      "netloc": "",
      "path": "",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    })

  # The only exception is thrown if an invalid port is given.
  def func():
    testurlparse_test("scheme://user:pass@host:88-88/path?query#fragment", {})
  testurlparse_expectException(func, ValueError,
    "\tError: Expected exception 'ValueError'")

  # Misc. tests

  testurlparse_test("://?#",
    {
      "scheme": "",
      "netloc": "",
      "path": "://",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    })

  testurlparse_test("@://?#",
    {
      "scheme": "",
      "netloc": "",
      "path": "@://",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    })

  testurlparse_test(":@//?#",
    {
      "scheme": "",
      "netloc": "",
      "path": ":@//",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    })

  testurlparse_test("://@?#",
    {
      "scheme": "",
      "netloc": "",
      "path": "://@",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    })

  testurlparse_test("://?@#",
    {
      "scheme": "",
      "netloc": "",
      "path": "://",
      "query": "@",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    })

  testurlparse_test("://?#@",
    {
      "scheme": "",
      "netloc": "",
      "path": "://",
      "query": "",
      "fragment": "@",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    })

  testurlparse_test("foo1",
    {
      "scheme": "",
      "netloc": "",
      "path": "foo1",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    })

  testurlparse_test("foo1:bar2",
    {
      "scheme": "foo1",
      "netloc": "",
      "path": "bar2",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    })

  testurlparse_test("foo1@bar2",
    {
      "scheme": "",
      "netloc": "",
      "path": "foo1@bar2",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    })

  testurlparse_test("foo1?bar2",
    {
      "scheme": "",
      "netloc": "",
      "path": "foo1",
      "query": "bar2",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    })

  testurlparse_test("foo1#bar2",
    {
      "scheme": "",
      "netloc": "",
      "path": "foo1",
      "query": "",
      "fragment": "bar2",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    })

  testurlparse_test("foo1/bar2",
    {
      "scheme": "",
      "netloc": "",
      "path": "foo1/bar2",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    })

  testurlparse_test(".",
    {
      "scheme": "",
      "netloc": "",
      "path": ".",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    })

  testurlparse_test("/.",
    {
      "scheme": "",
      "netloc": "",
      "path": "/.",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    })

  testurlparse_test("..",
    {
      "scheme": "",
      "netloc": "",
      "path": "..",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    })

  testurlparse_test("../..",
    {
      "scheme": "",
      "netloc": "",
      "path": "../..",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    })

  testurlparse_test("../../foo/",
    {
      "scheme": "",
      "netloc": "",
      "path": "../../foo/",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    })

  testurlparse_test("../../foo/bar/baz/..",
    {
      "scheme": "",
      "netloc": "",
      "path": "../../foo/bar/baz/..",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    })

  testurlparse_test("/foo/bar/baz/..",
    {
      "scheme": "",
      "netloc": "",
      "path": "/foo/bar/baz/..",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    })

  testurlparse_test("//foo",
    {
      "scheme": "",
      "netloc": "foo",
      "path": "",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": "foo",
      "port": None
    })

  testurlparse_test("//foo/bar",
    {
      "scheme": "",
      "netloc": "foo",
      "path": "/bar",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": "foo",
      "port": None
    })

  testurlparse_test("//foo/bar?baz=1&q=2",
    {
      "scheme": "",
      "netloc": "foo",
      "path": "/bar",
      "query": "baz=1&q=2",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": "foo",
      "port": None
    })

  testurlparse_test("baz=1&q=2",
    {
      "scheme": "",
      "netloc": "",
      "path": "baz=1&q=2",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    })

  testurlparse_test("baz=1&q=2#frag#frag",
    {
      "scheme": "",
      "netloc": "",
      "path": "baz=1&q=2",
      "query": "",
      "fragment": "frag#frag",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    })

  testurlparse_test("baz=1&q=2#frag#frag?a",
    {
      "scheme": "",
      "netloc": "",
      "path": "baz=1&q=2",
      "query": "",
      "fragment": "frag#frag?a",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    })

  testurlparse_test("?baz=1&q=2#frag#frag?a",
    {
      "scheme": "",
      "netloc": "",
      "path": "",
      "query": "baz=1&q=2",
      "fragment": "frag#frag?a",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    })

  testurlparse_test("http://host/path?baz=1&q=2#frag#frag?a",
    {
      "scheme": "http",
      "netloc": "host",
      "path": "/path",
      "query": "baz=1&q=2",
      "fragment": "frag#frag?a",
      "username": None,
      "password": None,
      "hostname": "host",
      "port": None
    })

  # Test a valid absolute URL.
  testurlparse_test("scheme://user:pass@host:8888/path?query#fragment",
    {
      "scheme": "scheme",
      "netloc": "user:pass@host:8888",
      "path": "/path",
      "query": "query#fragment",
      "fragment": "",
      "username": "user",
      "password": "pass",
      "hostname": "host",
      "port": 8888
    }, ("defaultscheme", False))

  # Test a valid relative URL.
  testurlparse_test("scheme:/path?query#fragment",
    {
      "scheme": "scheme",
      "netloc": "",
      "path": "/path",
      "query": "query#fragment",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    }, ("defaultscheme", False))

  # An empty URL.
  testurlparse_test("",
    {
      "scheme": "defaultscheme",
      "netloc": "",
      "path": "",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    }, ("defaultscheme", False))

  # The only exception is thrown if an invalid port is given.
  def func():
    testurlparse_test("scheme://user:pass@host:88-88/path?query#fragment", {},
      ("defaultscheme", False))
  testurlparse_expectException(func, ValueError,
    "\tError: Expected exception 'ValueError'")

  # Misc. tests

  testurlparse_test("://?#",
    {
      "scheme": "defaultscheme",
      "netloc": "",
      "path": "://",
      "query": "#",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    }, ("defaultscheme", False))

  testurlparse_test("@://?#",
    {
      "scheme": "defaultscheme",
      "netloc": "",
      "path": "@://",
      "query": "#",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    }, ("defaultscheme", False))

  testurlparse_test(":@//?#",
    {
      "scheme": "defaultscheme",
      "netloc": "",
      "path": ":@//",
      "query": "#",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    }, ("defaultscheme", False))

  testurlparse_test("://@?#",
    {
      "scheme": "defaultscheme",
      "netloc": "",
      "path": "://@",
      "query": "#",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    }, ("defaultscheme", False))

  testurlparse_test("://?@#",
    {
      "scheme": "defaultscheme",
      "netloc": "",
      "path": "://",
      "query": "@#",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    }, ("defaultscheme", False))

  testurlparse_test("://?#@",
    {
      "scheme": "defaultscheme",
      "netloc": "",
      "path": "://",
      "query": "#@",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    }, ("defaultscheme", False))

  testurlparse_test("foo1",
    {
      "scheme": "defaultscheme",
      "netloc": "",
      "path": "foo1",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    }, ("defaultscheme", False))

  testurlparse_test("foo1:bar2",
    {
      "scheme": "foo1",
      "netloc": "",
      "path": "bar2",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    }, ("defaultscheme", False))

  testurlparse_test("foo1@bar2",
    {
      "scheme": "defaultscheme",
      "netloc": "",
      "path": "foo1@bar2",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    }, ("defaultscheme", False))

  testurlparse_test("foo1?bar2",
    {
      "scheme": "defaultscheme",
      "netloc": "",
      "path": "foo1",
      "query": "bar2",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    }, ("defaultscheme", False))

  testurlparse_test("foo1#bar2",
    {
      "scheme": "defaultscheme",
      "netloc": "",
      "path": "foo1#bar2",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    }, ("defaultscheme", False))

  testurlparse_test("foo1/bar2",
    {
      "scheme": "defaultscheme",
      "netloc": "",
      "path": "foo1/bar2",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    }, ("defaultscheme", False))

  testurlparse_test(".",
    {
      "scheme": "defaultscheme",
      "netloc": "",
      "path": ".",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    }, ("defaultscheme", False))

  testurlparse_test("/.",
    {
      "scheme": "defaultscheme",
      "netloc": "",
      "path": "/.",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    }, ("defaultscheme", False))

  testurlparse_test("..",
    {
      "scheme": "defaultscheme",
      "netloc": "",
      "path": "..",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    }, ("defaultscheme", False))

  testurlparse_test("../..",
    {
      "scheme": "defaultscheme",
      "netloc": "",
      "path": "../..",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    }, ("defaultscheme", False))

  testurlparse_test("../../foo/",
    {
      "scheme": "defaultscheme",
      "netloc": "",
      "path": "../../foo/",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    }, ("defaultscheme", False))

  testurlparse_test("../../foo/bar/baz/..",
    {
      "scheme": "defaultscheme",
      "netloc": "",
      "path": "../../foo/bar/baz/..",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    }, ("defaultscheme", False))

  testurlparse_test("/foo/bar/baz/..",
    {
      "scheme": "defaultscheme",
      "netloc": "",
      "path": "/foo/bar/baz/..",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    }, ("defaultscheme", False))

  testurlparse_test("//foo",
    {
      "scheme": "defaultscheme",
      "netloc": "foo",
      "path": "",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": "foo",
      "port": None
    }, ("defaultscheme", False))

  testurlparse_test("//foo/bar",
    {
      "scheme": "defaultscheme",
      "netloc": "foo",
      "path": "/bar",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": "foo",
      "port": None
    }, ("defaultscheme", False))

  testurlparse_test("//foo/bar?baz=1&q=2",
    {
      "scheme": "defaultscheme",
      "netloc": "foo",
      "path": "/bar",
      "query": "baz=1&q=2",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": "foo",
      "port": None
    }, ("defaultscheme", False))

  testurlparse_test("baz=1&q=2",
    {
      "scheme": "defaultscheme",
      "netloc": "",
      "path": "baz=1&q=2",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    }, ("defaultscheme", False))

  testurlparse_test("baz=1&q=2#frag#frag",
    {
      "scheme": "defaultscheme",
      "netloc": "",
      "path": "baz=1&q=2#frag#frag",
      "query": "",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    }, ("defaultscheme", False))

  testurlparse_test("baz=1&q=2#frag#frag?a",
    {
      "scheme": "defaultscheme",
      "netloc": "",
      "path": "baz=1&q=2#frag#frag",
      "query": "a",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    }, ("defaultscheme", False))

  testurlparse_test("?baz=1&q=2#frag#frag?a",
    {
      "scheme": "defaultscheme",
      "netloc": "",
      "path": "",
      "query": "baz=1&q=2#frag#frag?a",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": None,
      "port": None
    }, ("defaultscheme", False))

  testurlparse_test("http://host/path?baz=1&q=2#frag#frag?a",
    {
      "scheme": "http",
      "netloc": "host",
      "path": "/path",
      "query": "baz=1&q=2#frag#frag?a",
      "fragment": "",
      "username": None,
      "password": None,
      "hostname": "host",
      "port": None
    }, ("defaultscheme", False))

  print "All tests passed"
